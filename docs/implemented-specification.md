# インクリメンタルファンタジー 完成版仕様書

## 1. ゲームの概要

プレイヤーがクリックでゴールドを獲得し、10種類の仲間と13種類の施設を購入・アップグレードして自動ゴールド生産量を増やしていくPC・スマホ対応のファンタジーRPG風インクリメンタルゲーム。視覚的な発展システムと中世ファンタジーデザインで没入感の高いゲーム体験を提供。

## 2. 実装済み機能詳細

### 2.1 ゲームシステム

#### クリック獲得システム
- **基本クリック値**: 1ゴールド/クリック（アップグレード可能）
- **クリック力アップグレード**: コスト = 現在のクリック力 × 10
- **視覚エフェクト**: クリック位置に金色の数値が浮上するアニメーション
- **ボタンデザイン**: 回転する魔法陣エフェクト付きの黄金ボタン

#### 自動獲得システム
- **更新間隔**: 100ms間隔での高精度計算
- **生産量計算**: 各エンティティの baseProduction × level
- **リアルタイム表示**: 毎秒生産量の即座更新
- **競合状態回避**: useLocalStorageでの適切な状態管理

#### アップグレードシステム
- **コスト計算**: baseCost × (1.15 ^ level)
- **解放条件**: 3種類（gold, entity_level, total_earned）
- **視覚フィードバック**: 2秒間の中央表示アップグレードエフェクト

### 2.2 エンティティシステム

#### 仲間（Companions）- 10種類
1. **👤 見習い冒険者** (基本コスト: 10, 生産: 0.1/s) - 初期解放
2. **⚔️ 勇敢な戦士** (基本コスト: 100, 生産: 1/s) - ゴールド50で解放
3. **🏹 精鋭弓兵** (基本コスト: 200, 生産: 2/s) - 戦士Lv3で解放
4. **🗡️ 影の盗賊** (基本コスト: 400, 生産: 4/s) - 弓兵Lv2で解放
5. **🧙‍♂️ 賢い魔法使い** (基本コスト: 800, 生産: 8/s) - 総獲得2000で解放
6. **⛪ 聖なる僧侶** (基本コスト: 1500, 生産: 15/s) - 魔法使いLv5で解放
7. **🛡️ 聖騎士** (基本コスト: 3000, 生産: 30/s) - 僧侶Lv3で解放
8. **💀 死霊術師** (基本コスト: 6000, 生産: 60/s) - 魔法使いLv8で解放
9. **🐉 古代のドラゴン** (基本コスト: 15000, 生産: 150/s) - 聖騎士Lv5で解放
10. **🔥 不死鳥** (基本コスト: 50000, 生産: 500/s) - ドラゴンLv10で解放

#### 施設（Facilities）- 13種類
1. **⛏️ 小さな鉱山** (基本コスト: 25, 生産: 0.5/s) - ゴールド15で解放
2. **🪓 伐採場** (基本コスト: 75, 生産: 1.5/s) - 鉱山Lv2で解放
3. **🌾 農場** (基本コスト: 150, 生産: 3/s) - 伐採場Lv2で解放
4. **🔨 鍛冶場** (基本コスト: 400, 生産: 6/s) - 戦士Lv3で解放
5. **🍺 酒場** (基本コスト: 800, 生産: 12/s) - 農場Lv3で解放
6. **🗼 魔法の塔** (基本コスト: 2000, 生産: 25/s) - 魔法使いLv2で解放
7. **📚 古代図書館** (基本コスト: 4000, 生産: 50/s) - 魔法の塔Lv3で解放
8. **⛪ 大聖堂** (基本コスト: 8000, 生産: 100/s) - 僧侶Lv5で解放
9. **🏟️ 闘技場** (基本コスト: 12000, 生産: 150/s) - 戦士Lv8で解放
10. **🏰 闇の要塞** (基本コスト: 20000, 生産: 250/s) - 死霊術師Lv3で解放
11. **🕳️ ドラゴンの巣** (基本コスト: 40000, 生産: 400/s) - ドラゴンLv5で解放
12. **🏛️ 王室金庫** (基本コスト: 75000, 生産: 750/s) - 総獲得200000で解放
13. **🌳 世界樹** (基本コスト: 150000, 生産: 1500/s) - 不死鳥Lv10で解放

### 2.3 視覚発展システム

#### 発展段階（総レベル数による判定）
- **🏕️ 開拓地** (0-4レベル): 冒険の始まり
- **🏡 小さな村** (5-19レベル): 小さな村ができた
- **🏘️ にぎやかな街** (20-49レベル): 活気ある街になった
- **🏙️ 発展した都市** (50-99レベル): 大きな都市に成長した
- **👑 繁栄する王国** (100-199レベル): 王国として発展している
- **🏰 偉大なる魔法帝国** (200+レベル): 伝説の帝国が誕生した

#### 王国表示システム
- **発展ヘッダー**: 現在の発展段階と統計バッジ表示
- **統計バッジ**: 仲間数、施設数、総レベル数の表示
- **カテゴリ分け**: 仲間軍団と施設建物の明確な分離

#### 仲間表示
- **密集アイコン表示**: レベル数分のアイコンが密集配置
- **最大15個表示**: それ以上は「+N」で省略表示
- **アニメーション**: 0.05秒間隔での時差登場エフェクト

#### 施設表示
- **グリッドレイアウト**: 都市らしい建物配置
- **発展段階別デザイン**: 王国レベルに応じて施設の見た目が変化
- **拡張表示**: レベルに応じた小さな拡張ブロック表示
- **ホバーエフェクト**: 施設情報のツールチップ表示

### 2.4 UI/UXデザイン

#### ファンタジーRPGテーマ
- **フォント**: Cinzel（メイン）、Cinzel Decorative（装飾）
- **カラーパレット**: 
  - ゴールド: #ffd700（メイン通貨色）
  - 背景: 深い夜空の魔法的グラデーション
  - アクセント: 218, 165, 32（古代の金）
- **魔法エフェクト**: text-shadow、box-shadow、backdrop-filter

#### レスポンシブデザイン
- **PC表示**: 横並びレイアウト（ヘッダー、メインエリア、サイドパネル）
- **タブレット**: 適応的なグリッドとアイコンサイズ
- **モバイル**: 縦並びレイアウト、サイドパネルを上部に移動

#### コンパクトヘッダー
- **薄型デザイン**: padding 0.75rem で画面を有効活用
- **横並び情報**: ゴールド表示と統計を効率配置
- **半透明効果**: 背景に溶け込む控えめなデザイン

### 2.5 データ構造と状態管理

#### TypeScript型定義
```typescript
interface PlayerState {
  gold: number;
  clickPower: number;
  goldPerSecond: number;
  totalGoldEarned: number;
  playtime: number;
}

interface GameEntity {
  id: string;
  name: string;
  description: string;
  level: number;
  baseCost: number;
  baseProduction: number;
  unlockCondition: UnlockCondition;
  isUnlocked: boolean;
  category: 'companion' | 'facility';
}

interface UnlockCondition {
  type: 'gold' | 'entity_level' | 'total_earned';
  threshold: number;
  entityId?: string;
}
```

#### カスタムフック
- **useGameState**: ゲーム状態の統合管理
- **useAutoGold**: 100ms間隔の自動ゴールド生成
- **useLocalStorage**: 競合状態を回避するストレージ管理

### 2.6 パフォーマンス最適化

#### 状態管理最適化
- **競合状態解決**: useLocalStorageでの適切な関数型更新
- **メモ化**: React.memo、useCallback、useMemoの活用
- **タイマー管理**: useEffectでの適切なクリーンアップ

#### レンダリング最適化
- **条件付きレンダリング**: 不要なコンポーネント描画の回避
- **アニメーション最適化**: CSS transformとopacityの活用
- **大数処理**: 数値フォーマット関数での効率的な表示

## 3. 技術スタック

### 3.1 フロントエンド
- **React 18**: 関数コンポーネント + Hooks
- **TypeScript**: 厳密な型安全性
- **Vite**: 高速開発環境
- **CSS**: ピュアCSS（ライブラリ依存なし）

### 3.2 状態管理
- **React Hooks**: useState, useEffect, useCallback
- **LocalStorage**: ブラウザ永続化
- **カスタムフック**: ロジック分離と再利用性

### 3.3 デザインシステム
- **Google Fonts**: Cinzelフォントファミリー
- **CSS Variables**: なし（直接指定で軽量化）
- **レスポンシブ**: CSS Media Queries

## 4. ファイル構成

```
src/
├── components/           # React コンポーネント
│   ├── Header.tsx       # ゲームヘッダー（統計表示）
│   ├── ClickButton.tsx  # メインクリックボタン
│   ├── EntityList.tsx   # 購入・アップグレードリスト
│   ├── LogPanel.tsx     # ゲームログ表示
│   ├── CompanionDisplay.tsx  # 王国発展表示
│   └── UpgradeEffect.tsx     # アップグレードエフェクト
├── hooks/               # カスタムフック
│   ├── useGameState.ts  # ゲーム状態管理
│   ├── useAutoGold.ts   # 自動ゴールド生成
│   └── useLocalStorage.ts    # ストレージ管理
├── types/               # TypeScript 型定義
│   └── game.ts          # ゲーム関連型
├── utils/               # ユーティリティ関数
│   ├── calculations.ts  # ゲーム計算ロジック
│   └── formatting.ts    # 数値・時間フォーマット
├── data/                # ゲームデータ
│   └── initial-entities.ts   # エンティティマスターデータ
└── App.css              # メインスタイルシート
```

## 5. ゲームバランス設計

### 5.1 進行曲線
- **序盤** (0-1000ゴールド): 基本的な仲間と施設の獲得
- **中盤** (1000-50000ゴールド): 魔法使いルートの開拓
- **上級** (50000-200000ゴールド): 聖騎士vs死霊術師の分岐
- **終盤** (200000+ゴールド): 神話級エンティティと帝国発展

### 5.2 解放チェーン設計
- **基礎産業チェーン**: 鉱山 → 伐採場 → 農場 → 酒場
- **戦士チェーン**: 戦士 → 弓兵 → 盗賊 → 鍛冶場 → 闘技場
- **魔法チェーン**: 魔法使い → 魔法の塔 → 図書館 → 僧侶 → 大聖堂
- **善悪分岐**: 聖騎士（光）vs 死霊術師（闇）
- **神話チェーン**: ドラゴン → 不死鳥 → 世界樹

### 5.3 数値バランス
- **クリック効率**: 初期は主力、中盤以降は補助的役割
- **生産効率**: 指数関数的成長でエンドレス性確保
- **解放タイミング**: 適度な間隔で新コンテンツ提供

## 6. ユーザー体験設計

### 6.1 プレイフロー
1. **チュートリアル**: 自然な誘導（説明テキストなし）
2. **初期成長**: 見習い冒険者からスタート
3. **選択分岐**: 戦士系 vs 魔法系の戦略選択
4. **王国発展**: 視覚的成長の実感
5. **エンドコンテンツ**: 神話級エンティティ収集

### 6.2 モチベーション維持
- **短期目標**: 次のエンティティ解放
- **中期目標**: 発展段階のアップグレード
- **長期目標**: 魔法帝国の完成
- **視覚的報酬**: アイコン増加と王国発展

### 6.3 アクセシビリティ
- **ツールチップ**: 全エンティティに詳細情報
- **視覚フィードバック**: 色とアニメーションで状態表示
- **レスポンシブ**: 全デバイスで快適操作
- **パフォーマンス**: 軽量で高速な動作

## 7. 今後の拡張可能性

### 7.1 実装済み基盤
- **モジュラー設計**: コンポーネント分離で拡張容易
- **型安全性**: TypeScriptによる堅牢な基盤
- **状態管理**: スケーラブルなフック設計
- **視覚システム**: 発展段階の拡張が容易

### 7.2 拡張アイデア
- **プレステージシステム**: 転生による永続ボーナス
- **実績システム**: 特定条件達成による報酬
- **イベントシステム**: 期間限定ボーナス
- **マルチプレイヤー**: 他プレイヤーとの協力・競争
- **AI生成コンテンツ**: 動的なエンティティ・イベント生成

## 8. 品質保証

### 8.1 テスト観点
- **機能テスト**: 全ゲーム機能の動作確認
- **パフォーマンステスト**: 長時間プレイでの安定性
- **レスポンシブテスト**: 各デバイスでの表示確認
- **ブラウザ互換性**: 主要ブラウザでの動作確認

### 8.2 エラーハンドリング
- **LocalStorage例外**: 容量制限・プライベートモード対応
- **数値オーバーフロー**: 大数値の適切な処理
- **状態競合**: タイマー処理での競合状態回避

このファンタジーインクリメンタルゲームは、シンプルながらも奥深いゲームプレイと美しいビジュアルで、プレイヤーに魔法王国を築く壮大な体験を提供します。